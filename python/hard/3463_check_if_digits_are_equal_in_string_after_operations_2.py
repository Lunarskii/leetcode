"""
You are given a string s consisting of digits. Perform the following operation repeatedly until the string has exactly
two digits:
    1. For each pair of consecutive digits in s, starting from the first digit, calculate a new digit as the sum of
    the two digits modulo 10.
    2. Replace s with the sequence of newly calculated digits, maintaining the order in which they are computed.
Return true if the final two digits in s are the same; otherwise, return false.

Example 1:
    Input: s = "3902"
    Output: true
    Explanation:
        1. Initially, s = "3902"
        2. First operation:
            (s[0] + s[1]) % 10 = (3 + 9) % 10 = 2
            (s[1] + s[2]) % 10 = (9 + 0) % 10 = 9
            (s[2] + s[3]) % 10 = (0 + 2) % 10 = 2
            s becomes "292"
        3. Second operation:
            (s[0] + s[1]) % 10 = (2 + 9) % 10 = 1
            (s[1] + s[2]) % 10 = (9 + 2) % 10 = 1
            s becomes "11"
        4. Since the digits in "11" are the same, the output is true.
Example 2:
    Input: s = "34789"
    Output: false
    Explanation:
        1. Initially, s = "34789".
        2. After the first operation, s = "7157".
        3. After the second operation, s = "862".
        4. After the third operation, s = "48".
        5. Since '4' != '8', the output is false.

Constraints:
    1. 3 <= s.length <= 10^5
    2. s consists of only digits.
"""
from math import gcd


def has_same_digits(s: str) -> bool:
    s_len: int = len(s)
    bin_coefficients: list[int] = _compute_binomial_coefficients_modulo(s_len - 2, 10)
    counts: list[int] = [0, 0]

    for idx, coefficient in enumerate(bin_coefficients):
        counts[0] += int(s[idx]) * coefficient
        counts[1] += int(s[idx + 1]) * coefficient
    return counts[0] % 10 == counts[1] % 10


def _compute_binomial_coefficients_modulo(n: int, mod: int) -> list[int]:
    coefficients: list[int] = [1]
    binomial_value: int = 1
    accumulated_factor: int = 1

    for k in range(n):
        numerator: int = n - k
        denominator: int = k + 1

        while (g := gcd(numerator, mod)) > 1:
            numerator //= g
            accumulated_factor *= g
        while (g := gcd(denominator, mod)) > 1:
            denominator //= g
            accumulated_factor //= g

        binomial_value = binomial_value * numerator * pow(denominator, -1, mod) % mod
        coefficients.append(binomial_value * accumulated_factor % mod)
    return coefficients


if __name__ == "__main__":
    assert has_same_digits("3902")
    assert not has_same_digits("34789")
    assert not has_same_digits("123")
    assert not has_same_digits("943")
    assert has_same_digits("323")
    assert not has_same_digits(
        "6540812454015009816483311963674858509497338319734410266257181797481468549611150081537475240311760601897007253340416149950042397618204420736285056346589738943105213862337125601826728517831936954807846670873181289620145743876712201629984379101007896224325437307181861176330571448959170384661061559721563726067987730529406721466696293273385892617219255450071513804580349359551407559020429595316673782474043962482892727572693435668483926207493188114508467057499976417775037622987615549001161582493304437059106028341988232245546327553595291496577081578925366068198271922746985375524943360894893883643180481978705370266688771916192067712073587274190764482718161528416069475931370925119785617561403229572950085152191710751782273632204089909607504556139688194715100171996528368125853649869063024688315905116178717173751584789528760607370388099914565407980615515518395263386644200634107279535978948985488316675454085122253993219427399483374427727407502087740123446193822534551293715003815282519302335841383420543366621995818611277102474995312518498446332740311680914487759464797195086678292315357669515591170261785945472515235873307839066724804874801603127467619046541200243953889210111567297388779251189611820923822369647563062556067413837015749424085809014561832656074360534852280389689545379088829001319453196883535642289093625471783620786324081706326073055604024480930169918516316298405062726308119574751688865807573761917610470316742015710793865063498613398556905530272616365405904393871558320441295488827249679687092366331968802944860721790601596377587589567160878837976019130479672784899298864656392515709137593552206583730929222668472600746611307716063732111562926150737013156575757868297836720377921398865037129795542606422239260105249795223224374487366759694436117125510636964930189851268893877308132555721204510531480236523629012436617050305510806602344487992082112528690416385622938173124290764288108462227256427250902120536049343743914238169931516354260993430369401603630665230617469801084504907627366860304190290590891883038302892082915609265274579856968602186382961248804789875515625062324457008011195962782047537435519191347321512486200518361484393019093861386979669738468139201221946201863162488121311945921028634445344422922746836617938854319265059963077904000293882698079860616825596238876752406038066969846865258439905214787134987590038656154175688766472650541815934654651760648106192319980506302140582926208136247553071062924314318889008422844833973519028865357005749436583764768493756514839283229338055765750039992061722789059664761130103288395920048880661530764087111821646151029945766039559553144543367050812637534513879869215751856124693536031331848986008640192271725399647302509337854275812800899277727563593142552918997577466829115016984593151107958660595063420493400720559994062306812987254190698161716123038507750582814333367207074410717237631304370550463680726083037185020138573417491039593562391534391993058362740058184988693276305302182913482579689825505023460452745649263675098443453814771113732627332617572251393856394842787706273047498722982657975789685385731890927007115143788730396581441180116543516447064624086898779623485535672268025967249916775595392123024597523194727894240514461051365653545384878245499524350766504491574891743678316239526121533926555348191497495194171313489548478825206957218355478779573946786119167720633699374093975069871892739511873139388345413910752429256796907024865957499147234204292494960734149834296613394518129440270389048363873342227769992668511363639222754154655186468100260050281209207208415813650973119601628542467236815323619591119889462690566601596592286535429136356773930068463417653029353981791840547994937434171224743171050367576220935367119734464496590196327753977447809141100725133503941726443522117662549572072366836116161360228311254092576883904836398964268788691666128345896048024771848120448079258406967999060201920580351186210853487913487087477315190067718390417557251250082151123197279876788822033114502851416703251610004382454589797699869638316941329959848658331588438668701768019514194431154933117114805296627003187315232019326061045080534207778485089567196139935553020656295442509034274443312134078705993986974389522765166422411274264114294823687874459319344311811874339602921123799463467208558066432343140701266914110484299875874195392526931063113452769034795393901764299300521963167958146968444379514997730815784587190295279410927722840803623233800499510195916582344662683429325069074857209958705180518962886694408467556661126149606034620201470694444347332012333073617200116252175929400625876847418453743999047581550069851734452816686145998298906007054537160379758372030910007629723773504013846400865961421741002505910351989345537182692353581878634981659790620248606211515785929574994437127209350944185201709455228104979881248634213041193479989618137412894004627178809163429507007795289828067809361641842135908699513103430742089363737900693331216066197390611732229269408351778922934896947542689899062317596687494497547017230115586960593433082343723199653641527894176463710679440955625711215239254293716610741991467206420271296200820688270252399921538459301681204226016641510420202201575745727083485433181428387409086131684965060960406842220640423984170594948448242055595281753327984726658234181643785115403712283605597390298016416320910647113009787610709880684163325138423193800071950671532854994764598049076240144133034842899235047657104849017136069133053279438610352081690998007979375991816869967626763601910276786872403850162740897678064146245059781049318805957287422257750678980244666567690107143648674079212363261748837159309384047177035007642355260659874656527591875432436400639808220638275440105299666211613999200736511638623917469001834031054247718646313343500211393272848679064119074504166278011081190364003787152820352392922475432568445254939664708266980070357319078857230339093224874666028021990087082880384188673425610584834810152363613270225214885299323648449631412810237851369370144151434135002278974364830263923318267506098599651912741821444311246107836714917943521971316325389015412320212690675268882512688548238938015426902363636141489065377402532142851831603084552340375409575626891250612267658829961901440167546745245426684007893233549782693948314751363541986397871804734331856161024142465566018644023321579266523390029438912035295422800522863724548793595741947007295674308518368918821427978583632904739807714577592748800795005142860162010931651404611685844040331736243431007791658381826385634100102933961856623030117265372034591727508612447437253121912209558570091463979360020162685518045323038463440797582520733042572312455266972490192063404068633316862217561722000235112673915900501360142434002840353438663942329464725217479315240588124050260233972701287604360262361579036245660125924240196616040367930016141743781162571515175323426521409079950908814106630852834210408006332513808542828280579805593188076501842332343753268911506232866036893735495833380362879455818841022093216222215574709897400243022716030945480718272909960044553062041833040007694104889563177270582372968263385178874769546111595741946093047199225895945676263883449922056561493819350361585153658725888150447121376987880346968251032199821618914262381026748341752451735965291288504906442311733354217943055015841250150680820178819621840051883606348238427054565758951080654486321816526985257915992247145143111101547171908455083895626084049951568657419827047902289161887795973478522469838411553568018800682421684989433579348234444216672192693167583221038097045038938719140949699504927058156570355757127585149235280709473099041208351999621362191733737663408676069491232374793345189421684980437627804458109310688910368283731876397586125141886550437564918755338868763870611378613006380418132992325406394291826229795407929315995478117103459017555954672716480219843884607401389649935129057297239277562133695626900871481000215696654857427841013178167703474988191955868936082207688908599213083098281862557901156641207403613129542547288938458492220008015478399109051504134504933451982538932605831190153908952692224063247518404507684373602874726321140545455103235768630738900829539979399371353325287452150724036403534435090108749219899841772005980467827006948060663467578591449802513467117726303864967099557165383663029606196455885025562731174004243863087458136365570157802553717860890575123500806640410020890276310880559479479102315213747844861271086639595220152857096765343619339638593700263464492347942150160932994370390556313567007046632898260588625123045756737121216796755904815875928283056071109086078788801191233210879005246030147778970991463950431310103089472777408118248793168419523653578205373294719807324539678448721818148486741502240396738712956515070982548545425060102883009768776243113609975820850612523126715192317476527042434935728993716032557155444876859711048121716064529498891008341909313352881901605474905342982002191913374048440245318016877827998700604259413952374664114028936853048045050297410707359888666020446697194223062727884056948292865943549164283155108317554001196246999684931969543213229216806476868599122287841737753330664302522010794174951211501721190697363478899625138877549414992038059482259550030096625159012394524373602149704937714280624404196561937148476209177715650089242251079187104582184577908396071426426876141794510673776572826209702017187799293079819399666784452374160315476721475995823257230178950558406700275187511378530995433842781393254543010614455563535663474729130455645215547279908822845030085878913697979376557561162045759258928386673915786094969503162011532035683410797071181882804393959045399625950907725463214021951"
    )
